{% extends "layout.html" %}
{% block content %}

<div class="card">
  <div class="catalog-head">
    <div>
      <h2 style="margin:0;">{{ titulo }}</h2>
      <p class="muted" style="margin:6px 0 0;">Gestión de productos con imagen, stock y estado.</p>
    </div>

    <a class="btn btn--primary" href="{{ url_for('catalogo_nuevo', tipo=tipo) }}">➕ Nuevo producto</a>
  </div>

  <form method="GET" class="catalog-search">
    <input class="input" type="text" name="q" value="{{ q }}" placeholder="Buscar por SKU, nombre o categoría">
    <button class="btn" type="submit">Buscar</button>
    <a class="btn" href="{{ url_for('catalogo_maquinas' if tipo=='maquina' else 'catalogo_insumos') }}">Limpiar</a>
  </form>

  <div class="catalog-grid">
    {% if productos and productos|length > 0 %}
      {% for p in productos %}
      <div class="product-card">
        <div class="product-card__imgwrap">
          {% if p["imagen_filename"] %}
            <img class="product-thumb" src="{{ url_for('static', filename='uploads/' ~ p['imagen_filename']) }}" alt="imagen">
          {% else %}
            <div class="product-thumb--empty">Sin imagen</div>
          {% endif %}
        </div>

        <div class="product-card__body">
          <p class="product-title">{{ p["nombre"] }}</p>
          <p class="product-meta">
            <b>SKU:</b> {{ p["sku"] if p["sku"] else "-" }}<br>
            <b>Categoría:</b> {{ p["categoria"] if p["categoria"] else "-" }}<br>
            <b>Stock:</b> {{ p["stock_actual"] }} | <b>Mín:</b> {{ p["stock_min"] }}
          </p>

          <div class="product-actions">
            <a class="btn" href="{{ url_for('catalogo_editar', tipo=tipo, pid=p['id']) }}">✏ Editar</a>

            <form method="POST" action="{{ url_for('catalogo_toggle', tipo=tipo, pid=p['id']) }}">
              <button class="btn {% if p['activo']==1 %}btn--danger{% endif %}" type="submit">
                {% if p["activo"]==1 %}Desactivar{% else %}Activar{% endif %}
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p class="muted">No hay productos para mostrar.</p>
    {% endif %}
  </div>

  {% if total_pages and total_pages > 1 %}
  <div class="pagination">
    {% if page > 1 %}
      <a class="btn" href="{{ url_for('catalogo_maquinas' if tipo=='maquina' else 'catalogo_insumos', q=q, page=page-1) }}">← Anterior</a>
    {% endif %}

    <div class="pagination__info">
      Página <b>{{ page }}</b> de <b>{{ total_pages }}</b>
    </div>

    {% if page < total_pages %}
      <a class="btn" href="{{ url_for('catalogo_maquinas' if tipo=='maquina' else 'catalogo_insumos', q=q, page=page+1) }}">Siguiente →</a>
    {% endif %}
  </div>
  {% endif %}

</div>

{% endblock %}



