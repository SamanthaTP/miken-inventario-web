{% extends "layout.html" %}
{% block content %}

<div class="card">
  {% if modo == "abrir" %}
    <h2 style="margin:0 0 6px 0;">ðŸ”“ Abrir caja</h2>
    <p style="margin:0 0 14px; color:var(--muted); font-weight:650;">DÃ­a: <b>{{ dia }}</b></p>

    <form method="post">
      <div style="display:grid; gap:12px; max-width:520px;">
        <label style="font-weight:800;">Efectivo inicial (Quito)</label>
        <input name="efectivo_inicial" type="number" step="0.01" required
               style="padding:10px; border-radius:12px; border:1px solid var(--border);">

        <label style="font-weight:800;">Nota (opcional)</label>
        <input name="nota" type="text"
               style="padding:10px; border-radius:12px; border:1px solid var(--border);">

        <button class="btn btn--primary" type="submit">Abrir caja</button>
        <a class="btn" href="{{ url_for('caja_home') }}">Volver</a>
      </div>
    </form>

  {% else %}
    <h2 style="margin:0 0 6px 0;">âž• Registrar movimiento de caja</h2>
    <p style="margin:0 0 14px; color:var(--muted); font-weight:650;">
      Puede registrar efectivo o banco. En banco, use comprobante.
    </p>

    <form method="post">
      <div class="grid">
        <div>
          <label style="font-weight:800;">DÃ­a (YYYY-MM-DD)</label>
          <input name="dia" value="{{ dia }}" required
                 style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);">
          <small style="color:var(--muted); font-weight:650;">Para registrar dÃ­as anteriores.</small>
        </div>

        <div>
          <label style="font-weight:800;">Fecha/hora (opcional)</label>
          <input name="fecha_full" placeholder="2026-01-11 14:30:00"
                 style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);">
          <small style="color:var(--muted); font-weight:650;">Si no se llena, toma la fecha actual.</small>
        </div>

        <div>
          <label style="font-weight:800;">Tipo de movimiento</label>
          <select name="tipo_mov" style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);">
            <option value="ingreso">Ingreso</option>
            <option value="egreso">Egreso</option>
          </select>
        </div>

        <div>
          <label style="font-weight:800;">MÃ©todo</label>
          <select name="medio" id="metodo"
                  style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);"
                  onchange="toggleReferencia()">
            <option value="efectivo">Efectivo</option>
            <option value="banco">Banco</option>
          </select>
        </div>

        <div>
          <label style="font-weight:800;">Monto</label>
          <input name="monto" type="number" step="0.01" required
                 style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);">
        </div>

        <div>
          <label style="font-weight:800;">Motivo</label>
          <input name="motivo" type="text" placeholder="Ej: compra insumos / venta local"
                 style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);">
        </div>

        <div id="refBox" style="display:none;">
          <label style="font-weight:800;">Comprobante / Referencia (banco)</label>
          <input name="referencia" type="text" placeholder="Ej: TRF-12345"
                 style="width:100%; padding:10px; border-radius:12px; border:1px solid var(--border);">
        </div>

        <div>
          <label style="font-weight:800;">Enviar caja a matriz (Machala)</label>
          <div style="margin-top:8px;">
            <label style="font-weight:650;">
              <input type="checkbox" name="enviado_matriz" value="1">
              Marcar como enviado a matriz (efectivo)
            </label>
          </div>
          <small style="color:var(--muted); font-weight:650;">Ãšselo cuando salga caja chica a matriz.</small>
        </div>
      </div>

      <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn btn--primary" type="submit">Guardar</button>
        <a class="btn" href="{{ url_for('caja_home') }}">Volver</a>
        <a class="btn" href="{{ url_for('caja_movimientos_list') }}">Ver historial</a>
      </div>
    </form>

    <script>
      function toggleReferencia(){
        const metodo = document.getElementById('metodo').value;
        const box = document.getElementById('refBox');
        box.style.display = (metodo === 'banco') ? 'block' : 'none';
      }
      toggleReferencia();
    </script>
  {% endif %}
</div>

{% endblock %}

